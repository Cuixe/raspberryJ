group 'org.cuixe'
version '1.0-SNAPSHOT'

buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
}

apply plugin: 'java'
apply plugin: 'application'

repositories {
    mavenCentral()
    maven {
        url "https://oss.sonatype.org/content/groups/public"
    }
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'
    compile 'com.pi4j:pi4j-core:1.2-SNAPSHOT'
    compile 'org.apache.logging.log4j:log4j-core:+'
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.12'
}

mainClassName = 'org.cuixe.raspberry.Main'

task makeDirStructure()  << {
    description = 'Prepara la estructura de archivos, para deploy local o remoto'
    File distdir = new File("${buildDir}")
    distdir.mkdir()
    distdir = new File("${buildDir}/distribution/")
    distdir.mkdir()
    distdir = new File("${buildDir}/distribution/libs")
    distdir.mkdir()
    distdir = new File("${buildDir}/distribution/etc")
    distdir.mkdir()
    distdir = new File("${buildDir}/distribution/bin")
    distdir.mkdir()
}

task copyLibsToDistribution(type: Copy) {
    from configurations.runtime
    into "${buildDir}/distribution/libs"
    include "**.jar"
}

task copyLibToDistribution(type: Copy) {
    from "${buildDir}/libs"
    into "${buildDir}/distribution/libs"
    include "**.jar"
}

task copyShells(type: Copy) {
    from "${buildDir}/resources/main/bin"
    into "${buildDir}/distribution/bin"
    include "**/*"
}
task copyConfigFiles(type: Copy) {
    from "${buildDir}/resources/main/etc"
    into "${buildDir}/distribution/etc"
    include "**/*"
}

task copyLaunch(type: Copy) {
    from "${buildDir}/resources/main/launch"
    into "${buildDir}/distribution"
    include "**/*"
}

task tarDistFile(type: Tar) {
    from "${buildDir}/distribution/"
    baseName applicationName
    compression Compression.GZIP
    destinationDir "${buildDir}" as File
}

task buildDistribution(dependsOn:['makeDirStructure', 'build']) << {
    copyShells.copy()
    copyLaunch.copy()
    copyConfigFiles.copy()
    copyLibsToDistribution.copy()
    copyLibToDistribution.copy()
    tarDistFile.execute()
}